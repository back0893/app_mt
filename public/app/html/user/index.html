
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>用户中心</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="keywords" content="fly,layui,前端社区">
  <meta name="description" content="Fly社区是模块化前端UI框架Layui的官网社区，致力于为web开发提供强劲动力">
  <link rel="stylesheet" href="../../res/layui/css/layui.css">
  <link rel="stylesheet" href="../../res/css/global.css">
</head>
<body>

<div class="fly-header layui-bg-black">
  <div class="layui-container">
    <a class="fly-logo" href="/">
      <img src="../../res/images/logo.png" alt="layui">
      <ul class="layui-nav fly-nav layui-hide-xs">
      <li class="layui-nav-item layui-this">
        <a href="/index.html"><i class="iconfont icon-jiaoliu"></i>首页</a>
      </li>
     </ul>
    </a>
    <ul class="layui-nav fly-nav-user">
       <!-- 登入后的状态 -->
      <li class="layui-nav-item">
        <a class="fly-nav-avatar" href="javascript:;">
          <cite class="layui-hide-xs" id='username'></cite>
          <img id='icon' src="#">
        </a>
        <dl class="layui-nav-child">
        	<dd><a href="user/index.html"><i class="layui-icon">&#xe620;</i>用户中心</a></dd>
          <dd><a href="user/set.html"><i class="layui-icon">&#xe620;</i>基本设置</a></dd>
          <dd><a href="user/message.html"><i class="iconfont icon-tongzhi" style="top: 4px;"></i>我的消息</a></dd>
          <hr style="margin: 5px 0;">
          <dd><a id='logout' style="text-align: center;">退出</a></dd>
        </dl>
      </li>
    </ul>
  </div>
</div>

<div class="layui-container fly-marginTop fly-user-main">
  <ul class="layui-nav layui-nav-tree layui-inline" lay-filter="user">
    <li class="layui-nav-item layui-this">
      <a href="index.html">
        <i class="layui-icon">&#xe612;</i>
        用户中心
      </a>
    </li>
    <li class="layui-nav-item">
      <a href="set.html">
        <i class="layui-icon">&#xe620;</i>
        基本设置
      </a>
    </li>
    <li class="layui-nav-item">
      <a href="message.html">
        <i class="layui-icon">&#xe611;</i>
        我的消息
      </a>
    </li>
  </ul>

  <div class="site-tree-mobile layui-hide">
    <i class="layui-icon">&#xe602;</i>
  </div>
  <div class="site-mobile-shade"></div>
  
  <div class="site-tree-mobile layui-hide">
    <i class="layui-icon">&#xe602;</i>
  </div>
  <div class="site-mobile-shade"></div>
  
  
  <div class="fly-panel fly-panel-user" pad20>
    <div class="layui-tab layui-tab-brief" lay-filter="user">
      <ul class="layui-tab-title" id="LAY_mine">
        <li data-type="mine-jie" lay-id="index" class="layui-this">持有</li>
         <li data-type="collection" lay-id="collection">买卖情况</li>
      </ul>
      <div class="layui-tab-content" style="padding: 20px 0;">
        <div class="layui-tab-item layui-show">
          <ul class="mine-view jie-row" id='own'>
            <li>
              <p>没有持有</p>
            </li>
          </ul>
          <div id="LAY_page"></div>
        </div>
        <div class="layui-tab-item">
          <ul class="mine-view jie-row" id='history'>
              <p>没有记录</p>
          </ul>
          <div id="LAY_page1"></div>
        </div>
      
      </div>
    </div>
  </div>
</div>

<div class="fly-footer">
</div>

<script src="../../res/layui/layui.js"></script>
<script src='../../res/my/config.js'></script>
<script>
window.$=null;
window.layer=null;
layui.use(['layer','laypage'],function(){
	var laypage=layui.laypage;
	function history_init(page){
		$.post(config.domain+'api/history/index.html',{token:localStorage.getItem('token'),page:page},function(response){
		var html='';
		if(response.code==1){
			$.each(response.data.history,function(i,k){
				 html+='<li>'+
				 			'<a class="jie-title">'+k.code+'</a>'+
              '<p>'+k.status+'于'+k.createtime+'买入数量为:'+k.number+'单价为:'+k.price+
              '</p><em>花费:'+k.money+'元</em>'
			});
		}else{
			html='没有购买记录';
		}
		$('#history').empty().append(html);
	});
	};
	
	function own_init(page){
		$.post(config.domain+'api/history/own.html',{token:localStorage.getItem('token'),page:page},function(response){
		var html='';
		if(response.code==1){
			 $.each(response.data.own,function(k,data){
			 	html+='<li>'+
              '<a class="jie-title">'+data.name+'</a>'+
              '<a>持有:'+data.number+'</a>'+
              '<a>买入价格:'+data.price+'</a>'+
              '<em>总计:'+data.money+'元</em>'+
            	'</li>'	;
			 	});
			}else{
				html='<p>没有持有</p>';
			}
	 		$('#own').empty().append(html);
		});
	}
	
	window.layer=layui.layer;
	var $=layui.$;
	
	
		
	  //手机设备的简单适配
  var treeMobile = $('.site-tree-mobile')
  ,shadeMobile = $('.site-mobile-shade')

treeMobile.on('click', function(){
    $('body').addClass('site-mobile');
});
shadeMobile.on('click', function(){
    $('body').removeClass('site-mobile');
});
	
	
	
	
	
	$(function(){
		$.post(config.domain+'api/history/pageCount.html',{token:localStorage.getItem('token')},function(response){
			laypage.render({
				elem:'LAY_page1',
				count:response.data.page1,
				jump:function(obj,first){
					history_init(obj.curr);
				}
			});
			laypage.render({
				elem:'LAY_page1',
				count:response.data.page1,
				jump:function(obj,first){
					own_init(obj.curr);
				}
			});
		})
	$(function(){
		if(!localStorage.getItem('userInfo')){
		location.href='/user/login.html';
	}
  	if(localStorage.getItem('userInfo')){
		  	$('.unlogin').hide();
		  	$('.login').show();
		  	var userInfo=JSON.parse(localStorage.getItem('userInfo'));
		  	var icon=userInfo.avatar?userInfo.avatar:config.default_icon;
		  	$('#username').text(userInfo.username);
		  	$('#icon').attr('src',icon);
		  }else{
		  	$('.login').hide();
		  	$('.unlogin').show();
		  };
  })
	})
})
layui.use('element',function(){
	var element=layui.element;
})
</script>

</body>
</html>