
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>帐号设置</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="keywords" content="fly,layui,前端社区">
  <meta name="description" content="Fly社区是模块化前端UI框架Layui的官网社区，致力于为web开发提供强劲动力">
  <link rel="stylesheet" href="../../res/layui/css/layui.css">
  <link rel="stylesheet" href="../../res/css/global.css">
</head>
<body>

<div class="fly-header layui-bg-black">
  <div class="layui-container">
    <a class="fly-logo" href="/">
      <img src="../../res/images/logo.png" alt="layui">
      <ul class="layui-nav fly-nav layui-hide-xs">
      <li class="layui-nav-item layui-this">
        <a href="/index.html"><i class="iconfont icon-jiaoliu"></i>首页</a>
      </li>
     </ul>
    </a>
     <ul class="layui-nav fly-nav-user">
       <!-- 登入后的状态 -->
      <li class="layui-nav-item">
        <a class="fly-nav-avatar" href="javascript:;">
          <cite class="layui-hide-xs" id='username'></cite>
          <img id='icon' src="#">
        </a>
        <dl class="layui-nav-child">
        	<dd><a href="user/index.html"><i class="layui-icon">&#xe620;</i>用户中心</a></dd>
          <dd><a href="user/set.html"><i class="layui-icon">&#xe620;</i>基本设置</a></dd>
          <dd><a href="user/message.html"><i class="iconfont icon-tongzhi" style="top: 4px;"></i>我的消息</a></dd>
          <hr style="margin: 5px 0;">
          <dd><a id='logout' style="text-align: center;">退出</a></dd>
        </dl>
      </li>
    </ul>
  </div>
</div>

<div class="layui-container fly-marginTop fly-user-main">
  <ul class="layui-nav layui-nav-tree layui-inline" lay-filter="user">
    <li class="layui-nav-item">
      <a href="index.html">
        <i class="layui-icon">&#xe612;</i>
        用户中心
      </a>
    </li>
    <li class="layui-nav-item layui-this">
      <a href="set.html">
        <i class="layui-icon">&#xe620;</i>
        基本设置
      </a>
    </li>
    <li class="layui-nav-item">
      <a href="message.html">
        <i class="layui-icon">&#xe611;</i>
        我的消息
      </a>
    </li>
  </ul>

  <div class="site-tree-mobile layui-hide">
    <i class="layui-icon">&#xe602;</i>
  </div>
  <div class="site-mobile-shade"></div>
  
  
  
  <div class="fly-panel fly-panel-user" pad20>
    <div class="layui-tab layui-tab-brief" lay-filter="user">
      <ul class="layui-tab-title" id="LAY_mine">
        <li class="layui-this" lay-id="info">我的资料</li>
        <li lay-id="avatar">头像</li>
        <li lay-id="pass">密码</li>
        <li lay-id="bind">绑定支付宝</li>
        <li lay-id="bind">绑定微型</li>
      </ul>
      <div class="layui-tab-content" style="padding: 20px 0;">
        <div class="layui-form layui-form-pane layui-tab-item layui-show">
          <form method="post">
            <div class="layui-form-item">
              <label for="L_email" class="layui-form-label">邮箱</label>
              <div class="layui-input-inline">
                <input type="text" id="L_email" name="email" required lay-verify="email" autocomplete="off" value="" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label for="L_nickname" class="layui-form-label">昵称</label>
              <div class="layui-input-inline">
                <input type="text" id="L_nickname" name="nickname" required lay-verify="required" autocomplete="off" value="" class="layui-input">
              </div>
              <div class="layui-inline">
                <div class="layui-input-inline">
                  <input type="radio" name="gender" value="0" checked title="男">
                  <input type="radio" name="gender" value="1" title="女">
                </div>
              </div>
            </div>
            <div class="layui-form-item">
              <label for="L_birthday" class="layui-form-label">生日</label>
              <div class="layui-input-inline">
                <input type="text" id="L_birthday" name="birthday" autocomplete="off" value="" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label" for="free">活动资金</label>
              <div class="layui-input-inline">
                <input type="text" value="" class="layui-input" id="free" readonly="readonly">
              </div>
               <div class="layui-inline">
                <div class="layui-input-inline">
									  <div class="layui-btn-group">
									   <a class="layui-btn layui-btn-primary" id='in'>转入</a>
    								 <a class="layui-btn layui-btn-primary" id='out'>转出</a>
									  </div>
                </div>
              </div>
            </div> 
            <div class="layui-form-item layui-form-text">
              <label for="L_sign" class="layui-form-label">签名</label>
              <div class="layui-input-block">
                <textarea placeholder="随便写些什么刷下存在感" id="L_bio"  name="bio" autocomplete="off" class="layui-textarea" style="height: 80px;"></textarea>
              </div>
            </div>
            <div class="layui-form-item">
              <button class="layui-btn" key="set-mine" lay-filter="info" lay-submit>确认修改</button>
            </div>
          </form>
          </div>
          <div class="layui-form layui-form-pane layui-tab-item">
            <div class="layui-form-item">
              <div class="avatar-add">
                <p>建议尺寸168*168，支持jpg、png、gif，最大不能超过50KB</p>
                <button type="button" class="layui-btn upload-img" id='upload_img'>
                  <i class="layui-icon">&#xe67c;</i>上传头像
                </button>
                <img id='avatar' src="">
                <span class="loading"></span>
              </div>
            </div>
          </div>
          
          <div class="layui-form layui-form-pane layui-tab-item">
            <form action="/user/repass" method="post">
              <div class="layui-form-item">
                <label for="L_nowpass" class="layui-form-label">当前密码</label>
                <div class="layui-input-inline">
                  <input type="password" id="L_nowpass" name="nowpass" required lay-verify="required" autocomplete="off" class="layui-input">
                </div>
              </div>
              <div class="layui-form-item">
                <label for="L_pass" class="layui-form-label">新密码</label>
                <div class="layui-input-inline">
                  <input type="password" id="L_pass" name="pass" required lay-verify="required" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid layui-word-aux">6到16个字符</div>
              </div>
              <div class="layui-form-item">
                <label for="L_repass" class="layui-form-label">确认密码</label>
                <div class="layui-input-inline">
                  <input type="password" id="L_repass" name="repass" required lay-verify="required" autocomplete="off" class="layui-input">
                </div>
              </div>
              <div class="layui-form-item">
                <button class="layui-btn" key="set-mine" lay-filter="password" lay-submit>确认修改</button>
              </div>
            </form>
          </div>
          
          <div class="layui-form layui-form-pane layui-tab-item">
          	 <form method="post">
          	 	<input type='hidden' name='payType' value='wx'>
            <div class="layui-form-item">
              <label for="L_name" class="layui-form-label">支付宝帐号</label>
              <div class="layui-input-inline">
                <input type="text" id="L_name" name="name" required lay-verify="required" autocomplete="off" value="" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label for="L_code" class="layui-form-label">姓名</label>
              <div class="layui-input-inline">
                <input type="text" id="L_code" name="code" required lay-verify="required" autocomplete="off" value="" class="layui-input">
              </div>
            </div>
              <button class="layui-btn" key="set-mine" lay-filter="bank" lay-submit>绑定</button>
            </div>
            
            <div class="layui-form-pane layui-tab-item">
          		<p>微信提现发送红包</p>
          		<p>这样就自能是关注公众号才能实现了.</p>
          		<img src='#' title='公众号二维码'>
          		<p>用户关注后,发送红包</p>
          		<p>但是时间最少需要90天才行</p>
            </div>
          </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<div class="fly-footer">
 
</div>

<script src="../../res/layui/layui.js"></script>
<script src="../../res/my/config.js"></script>
<script>
layui.use(['form','layedit','laydate','layer','upload','element'],function(){
    var element = layui.element;
	var form=layui.form;
	var layer=layui.layer;
	var layedit=layui.layedit;
	var laydate=layui.laydate;
	var $=layui.$;

    laydate.render({
        elem: '#L_birthday' //指定元素
    });

	 $(function(){
  	if(localStorage.getItem('userInfo')){
		  	$('.unlogin').hide();
		  	$('.login').show();
		  	var userInfo=JSON.parse(localStorage.getItem('userInfo'));
		  	var icon=userInfo.avatar?userInfo.avatar:config.default_icon;
		  	$('#username').text(userInfo.username);
		  	$('#icon').attr('src',icon);
		  }else{
		  	$('.login').hide();
		  	$('.unlogin').show();
		  };
		 $.post(config.domain+'api/user/money.html',{token:localStorage.getItem('token')},function(response){
		 	$('#free').val(response.data.free);
		 });
  });
	var userInfo=JSON.parse(localStorage.getItem('userInfo'));
	var bank=JSON.parse(localStorage.getItem('bank'));
	$('#L_email').val(userInfo.email);
	$('#L_nickname').val(userInfo.nickname);
	$('#L_birthday').val(userInfo.birthday);
	$(':radio:eq('+userInfo.gender+')').prop('checked',true);
	$('#L_name').val(bank.name);
	$('#L_code').val(bank.code);
	$('#L_user_code').val(bank.user_code);
	$('#address').val(bank.address);
	
	
	
	  //手机设备的简单适配
  var treeMobile = $('.site-tree-mobile')
  ,shadeMobile = $('.site-mobile-shade');

  treeMobile.on('click', function(){
      $('body').addClass('site-mobile');
  });
  shadeMobile.on('click', function(){
      $('body').removeClass('site-mobile');
  });
	
	
	
	form.render('radio');
	$('#L_bio').val(userInfo.bio);
	form.on('submit(info)',function(data){
		var token=localStorage.getItem('token');
		var data=$.extend(data.field,{token:token});
		$.post(config.domain+'/api/user/profile.html',data,function(response){
			if(response.code==1){
				layer.alert('更新成功');
				localStorage.setItem('userInfo',JSON.stringify(data));
				return '';
			}
			layer.alert(response.msg);
		})
		return false;
	});
	form.on('submit(password)',function(data){
		var token=localStorage.getItem('token');
		var data=$.extend(data.field,{token:token});
		$.post(config.domain+'/api/user/updatePassword.html',data,function(response){
			if(response.code){
				layer.open({
					title:'成功',
					content:'密码修改成功,请重新登录',
					yes:function(){
						location.href='./login.html';
						}
				})}
				else{
					layer.alert('修改密码失败');
				}
		});
		return false;
	});
	form.on('submit(bank)',function(data){
		var token=localStorage.getItem('token');
		var tmp=$.extend(data.field,{token:token});
		$.post(config.domain+'/api/user/bindAli.html',tmp,function(response){
			if(response.code){
				layer.alert('绑定成功');
				localStorage.setItem('bank',JSON.stringify(data.field));
			}
			else{
				layer.alert('绑定失败');
			}
		});
		return false;
	});
    var upload=layui.upload;
    if(!localStorage.getItem('userInfo')){
        location.href='/user/login.html';
    }
    var userInfo=JSON.parse(localStorage.getItem('userInfo'));
    $('#avatar').attr('src',userInfo.avatar);
    var uploadInst=upload.render({
        elem:'#upload_img',
        url:config.domain+'api/user/icon.html',
        data:{token:localStorage.getItem('token')},
        done:function(res){
            if(res.code){
                userInfo.avatar=res.data.avatar;
                localStorage.setItem('userInfo',JSON.stringify(userInfo));
                localStorage.setItem('avatar',res.data.avatar);
                layer.alert('头像更新完成');
                $('#avatar').attr('src',res.data.avatar);
                location.reload();
            }

        },
        error:function(res){
            layer.alert('上传失败,请稍后再试');
        }
    });
    $('#in').click(function(){
        layer.open({
            type: 2,
            title: '充值',
            skin:'layui-layer-molv',
            shadeClose: true,
            shade: false,
            area:['100%','100%'],
            maxmin: true, //开启最大化最小化按钮
            content: './in.html'
        });
    });
    $('#out').click(function(){
        layer.open({
            type: 2,
            title: '转出',
            area:['100%','100%'],
            skin:'layui-layer-molv',
            shadeClose: true,
            shade: false,
            maxmin: true, //开启最大化最小化按钮
            content: './out.html'
        });
    })
});

</script>
</body>
</html>