
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>我的消息</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="keywords" content="fly,layui,前端社区">
  <meta name="description" content="Fly社区是模块化前端UI框架Layui的官网社区，致力于为web开发提供强劲动力">
  <link rel="stylesheet" href="../../res/layui/css/layui.css">
  <link rel="stylesheet" href="../../res/css/global.css">
</head>
<body>

<div class="fly-header layui-bg-black">
  <div class="layui-container">
    <a class="fly-logo" href="/">
      <img src="../../res/images/logo.png" alt="layui">
      <ul class="layui-nav fly-nav layui-hide-xs">
      <li class="layui-nav-item layui-this">
        <a href="/index.html"><i class="iconfont icon-jiaoliu"></i>首页</a>
      </li>
     </ul>
    </a>
     <ul class="layui-nav fly-nav-user">
       <!-- 登入后的状态 -->
      <li class="layui-nav-item">
        <a class="fly-nav-avatar" href="javascript:;">
          <cite class="layui-hide-xs" id='username'></cite>
          <img id='icon' src="#">
        </a>
        <dl class="layui-nav-child">
        	<dd><a href="user/index.html"><i class="layui-icon">&#xe620;</i>用户中心</a></dd>
          <dd><a href="user/set.html"><i class="layui-icon">&#xe620;</i>基本设置</a></dd>
          <dd><a href="user/message.html"><i class="iconfont icon-tongzhi" style="top: 4px;"></i>我的消息</a></dd>
          <hr style="margin: 5px 0;">
          <dd><a id='logout' style="text-align: center;">退出</a></dd>
        </dl>
      </li>
    </ul>
  </div>
</div>
<div class="layui-container fly-marginTop fly-user-main">
  <ul class="layui-nav layui-nav-tree layui-inline" lay-filter="user">
    <li class="layui-nav-item">
      <a href="index.html">
        <i class="layui-icon">&#xe612;</i>
        用户中心
      </a>
    </li>
    <li class="layui-nav-item">
      <a href="set.html">
        <i class="layui-icon">&#xe620;</i>
        基本设置
      </a>
    </li>
    <li class="layui-nav-item layui-this">
      <a href="message.html">
        <i class="layui-icon">&#xe611;</i>
        我的消息
      </a>
    </li>
  </ul>
    <div class="site-tree-mobile layui-hide">
    <i class="layui-icon">&#xe602;</i>
  </div>
  <div class="site-mobile-shade"></div>
  
  <div class="site-tree-mobile layui-hide">
    <i class="layui-icon">&#xe602;</i>
  </div>
  <div class="site-mobile-shade"></div>
  <div class="fly-panel fly-panel-user" pad20>
	  <div class="layui-tab layui-tab-brief" lay-filter="user" id="LAY_msg" style="margin-top: 15px;">
	    <button class="layui-btn layui-btn-danger" id="LAY_delallmsg">清空全部消息</button>
	    <div  id="LAY_minemsg" style="margin-top: 10px;">
        <ul class="mine-msg" id='mine_msg'>
        	<div class="fly-none">您暂时没有最新消息</div>
        </ul>
      </div>
	  </div>
	</div>

</div>
 <div class="site-tree-mobile layui-hide">
    <i class="layui-icon"></i>
  </div>
  <div class="site-mobile-shade"></div>
  
<div class="fly-footer">
</div>
<script src="../../res/layui/layui.js"></script>
<script src='../../res/my/config.js'></script>
<script>
	layui.use('element', function(){
  var element = layui.element;
});
layui.use('jquery',function(){
	var $=layui.jquery;
	if(!localStorage.getItem('userInfo')){
		location.href='/user/login.html';
	}
	$(function(){
		$.post(config.domain+'api/user/getIO.html',{token:localStorage.getItem('token')},function(response){
			var html='';
			$.each(response.data,function(i,k){
				html+='<li data-id="'+k.status+'">'+
            '<blockquote class="layui-elem-quote">'+
              	k.format+
            '</blockquote>'+
           ' <p><a href="javascript:;" class="layui-btn layui-btn-small layui-btn-danger fly-delete">已读</a></p>'+
          '</li>';
			})
			$('#mine_msg').empty().append(html);
		});
		
  	if(localStorage.getItem('userInfo')){
		  	$('.unlogin').hide();
		  	$('.login').show();
		  	var userInfo=JSON.parse(localStorage.getItem('userInfo'));
		  	var icon=userInfo.avatar?userInfo.avatar:config.default_icon;
		  	$('#username').text(userInfo.username);
		  	$('#icon').attr('src',icon);
		  }else{
		  	$('.login').hide();
		  	$('.unlogin').show();
		  };
		  
		$('#LAY_msg').on('click','#LAY_delallmsg,.fly-delete',function(){
			var _self=$(this).closest('li');
			var data={token:localStorage.getItem('token')};
			if(_self.attr('data-id')){
				data['status']=_self.data('id')
			}else{
				data['status']='all';
			}

			$.post(config.domain+'api/demo/message.html',data,function(response){
				if(response.msg=='all'){
					$('#LAY_minemsg').empty().append('<div class="fly-none">您暂时没有最新消息</div>');
				}else{
					_self.remove();
				}
			});
		});
		
		  //手机设备的简单适配
  var treeMobile = $('.site-tree-mobile')
  ,shadeMobile = $('.site-mobile-shade')

  treeMobile.on('click', function(){
    $('body').addClass('site-mobile');
  });

  shadeMobile.on('click', function(){
    $('body').removeClass('site-mobile');
  });
	})
})
layui.use('mobile',function(){
	var mobile=layui.mobile;
	window.layer=mobile.layer;
})
layui.use('element', function(){
  var element = layui.element;
});
</script>

</body>
</html>