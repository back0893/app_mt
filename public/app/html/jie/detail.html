<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Fly Template v3.0，基于 layui 的极简社区页面模版</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="keywords" content="fly,layui,前端社区">
  <meta name="description" content="Fly社区是模块化前端UI框架Layui的官网社区，致力于为web开发提供强劲动力">
  <link rel="stylesheet" href="../../res/layui/css/layui.css">
  <link rel="stylesheet" href="../../res/css/global.css">
  <link rel="stylesheet" href="../../res/layui/css/layui.mobile.css">
</head>
<body>

<div class="fly-header layui-bg-black">
  <div class="layui-container">
    <a class="fly-logo" href="/">
      <img src="../../res/images/logo.png" alt="layui">
    </a>
    <ul class="layui-nav fly-nav layui-hide-xs">
      <li class="layui-nav-item layui-this">
        <a href="/"><i class="iconfont icon-jiaoliu"></i>交流</a>
      </li>
      <li class="layui-nav-item">
        <a href="../case/case.html"><i class="iconfont icon-iconmingxinganli"></i>案例</a>
      </li>
      <li class="layui-nav-item">
        <a href="http://www.layui.com/" target="_blank"><i class="iconfont icon-ui"></i>框架</a>
      </li>
    </ul>
    
    <ul class="layui-nav fly-nav-user">
      
      <!-- 未登入的状态 -->
      <!--
      <li class="layui-nav-item">
        <a class="iconfont icon-touxiang layui-hide-xs" href="user/login.html"></a>
      </li>
      <li class="layui-nav-item">
        <a href="user/login.html">登入</a>
      </li>
      <li class="layui-nav-item">
        <a href="user/reg.html">注册</a>
      </li>
      <li class="layui-nav-item layui-hide-xs">
        <a href="/app/qq/" onclick="layer.msg('正在通过QQ登入', {icon:16, shade: 0.1, time:0})" title="QQ登入" class="iconfont icon-qq"></a>
      </li>
      <li class="layui-nav-item layui-hide-xs">
        <a href="/app/weibo/" onclick="layer.msg('正在通过微博登入', {icon:16, shade: 0.1, time:0})" title="微博登入" class="iconfont icon-weibo"></a>
      </li>
       -->
      
      <!-- 登入后的状态 -->
      <li class="layui-nav-item">
        <a class="fly-nav-avatar" href="javascript:;">
          <cite class="layui-hide-xs">贤心</cite>
          <i class="iconfont icon-renzheng layui-hide-xs" title="认证信息：layui 作者"></i>
          <i class="layui-badge fly-badge-vip layui-hide-xs">VIP3</i>
          <img src="https://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg">
        </a>
        <dl class="layui-nav-child">
          <dd><a href="../user/set.html"><i class="layui-icon">&#xe620;</i>基本设置</a></dd>
          <dd><a href="../user/message.html"><i class="iconfont icon-tongzhi" style="top: 4px;"></i>我的消息</a></dd>
          <dd><a href="../user/home.html"><i class="layui-icon" style="margin-left: 2px; font-size: 22px;">&#xe68e;</i>我的主页</a></dd>
          <hr style="margin: 5px 0;">
          <dd><a href="" style="text-align: center;">退出</a></dd>
        </dl>
      </li>
    </ul>
  </div>
</div>

<div class="layui-hide-xs">
  <div class="fly-panel fly-column">
    <div class="layui-container">
      <ul class="layui-clear">
        <li class="layui-hide-xs"><a href="/">首页</a></li> 
        <li class="layui-this"><a href="">提问</a></li> 
        <li><a href="">分享<span class="layui-badge-dot"></span></a></li> 
        <li><a href="">讨论</a></li> 
        <li><a href="">建议</a></li> 
        <li><a href="">公告</a></li> 
        <li><a href="">动态</a></li> 
        <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><span class="fly-mid"></span></li> 
        
        <!-- 用户登入后显示 -->
        <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a href="../user/index.html">我发表的贴</a></li> 
        <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><a href="../user/index.html#collection">我收藏的贴</a></li> 
      </ul> 
      
      <div class="fly-column-right layui-hide-xs"> 
        <span class="fly-search"><i class="layui-icon"></i></span> 
        <a href="add.html" class="layui-btn">发表新帖</a> 
      </div> 
      <div class="layui-hide-sm layui-show-xs-block" style="margin-top: -10px; padding-bottom: 10px; text-align: center;"> 
        <a href="add.html" class="layui-btn">发表新帖</a> 
      </div> 
    </div>
  </div>
</div>

<div class="layui-container">
  <div class="layui-row layui-col-space15">
    <div class="layui-col-md12 content detail">
      <div class="fly-panel detail-box" >
        <h1 style="text-align: center;" id='name'></h1>

        <div class="fly-detail-info">
          <span class="layui-badge layui-bg-red fly-detail-column" id='prev'>前一天</span>
          <button class="layui-btn layui-btn-radius layui-btn-normal" id='buy'>
      	  		买入
      	  	</button>
          <span class="fly-list-nums"> 
          		<button class="layui-btn layui-btn-radius layui-btn-normal" id='sail'>
    					买入
    				</button>
          		<span class="layui-badge layui-bg-red" id='next'>后一天</span>
          		
          </span>
        </div>
        <div class="detail-about">
        	<p>当前价格:<span id="current_price">0.00</span></p>
        	<p>我拥有:<span id="has">0</span></p>
        </div>
        <div class="detail-body photos" id='main2'></div>
      </div>
    </div>
   </div>
</div>

<div class="fly-footer">
  <p><a href="http://fly.layui.com/" target="_blank">Fly社区</a> 2017 &copy; <a href="http://www.layui.com/" target="_blank">layui.com 出品</a></p>
  <p>
    <a href="http://fly.layui.com/jie/3147/" target="_blank">付费计划</a>
    <a href="http://www.layui.com/template/fly/" target="_blank">获取Fly社区模版</a>
    <a href="http://fly.layui.com/jie/2461/" target="_blank">微信公众号</a>
  </p>
</div>

<script src="../../res/layui/layui.js"></script>
<script src='../../res/my/config.js'></script>
<script src="../../res/my/echarts.js"></script>
<script>
	var layer;
	var form;
	layui.use('form',function(){
		window.form=layui.form;
		var $=layui.$;
		form.on('submit(buy)',function(data){
			if(data.field.price<=0){
				layer.msg('不在交易时间内',{time:2*1000});
				return false;
			}
			var l=$.extend(data.field,{token:localStorage.getItem('token'),code:localStorage.getItem('code')});
			$.post(config.domain+'api/trade/buy',l,function(response){
				layer.msg(response.msg, {
					  time: 2000, //2s后自动关闭
					});
				});
			return false;
		});
		form.on('submit(sail)',function(data){
			if(data.field.price<=0){
				layer.msg('不在交易时间内',{time:2*1000});
				return false;
			}
			var l=$.extend(data.field,{token:localStorage.getItem('token'),code:'000001'});
			$.post(config.domain+'api/trade/sail',l,function(response){
				layer.msg(response.msg, {
					  time: 2000, //2s后自动关闭
					});
				});
			return false;
		});
	})
layui.use('mobile',function(){
	window.layer=layui.mobile.layer;
})
layui.use('jquery', function(){
  var $ = layui.$;
	layui.jquery=$;
  var myChart = echarts.init(document.getElementById('main2'));
var option = {
    backgroundColor: '#21202D',
    tooltip: {
        trigger: 'axis',
        axisPointer: {
            animation: false,
            type: 'cross',
            lineStyle: {
                color: '#376df4',
                width: 2,
                opacity: 1
            }
        },
        formatter:function(params){
        	return '时间:'+params[0].axisValue+'<br/>价格:'+params[0].data;
        }
    },
    xAxis: {
        type: 'category',
        axisLine: { lineStyle: { color: '#8392A5' } }
    },
    yAxis: {
        scale: true,
        axisLine: { lineStyle: { color: '#8392A5' } },
        splitLine: { show: false }
    },
    grid: {
        bottom: 80
    },
    animation: false,
    series: [
        {
            name: 'shares',
            type: 'line',
            smooth: true,
            showSymbol: false,
            lineStyle: {
                normal: {
                    width: 1
                }
            }
        }
    ]
};
myChart.setOption(option, true);
myChart.showLoading();
var a1=[],b1=[],a2=[],b2=[];
$.post(config.domain+'api/show_k/index.html',{code:localStorage.getItem('code'),'token':localStorage.getItem('token')},function(response){
		$('#name').text(response.data.name);
		$('#has').text(response.data.has);
		$('#prev').data('date',response.data.prev);
		$('#next').data('date',response.data.next);
		
		myChart.hideLoading();
		var c=new Date();
		var h=c.getHours();
		var m=c.getMinutes();
		if(h<10){
			h='0'+h;
		}
		if(m<10){
			m='0'+m;
		}
		var index=response.data.key.indexOf(h+':'+m)
		if(response.data.is_all){
			a1=[];
			b1=[];
			a2=response.data.key;
			b2=response.data.value;
		}else{
			a1=response.data.key.slice(index);
			a2=response.data.key.slice(0,index);
			b1=response.data.value.slice(index);
			b2=response.data.value.slice(0,index);
		}
		var tmp={
			title:{
				text:response.data.current,
			},
			xAxis:{
				data:a2
			},
			series:[
				{
					name:'shares',
					data:b2
				}
			]
		};
		myChart.setOption(tmp);
});
var i=setInterval(function(){
	if(a1.length==0){
		clearInterval(i);
		return '';
	}
	var price=b1.splice(0,1)[0];
	a2.push(a1.splice(0,1)[0]);
	b2.push(price);
	$('#buy_price').val(price);
	$('#sail_price').val(price);
	$('#current_price').text(price);
	myChart.setOption({
		xAxis:{
			data:a2
		},
		series:[
			{
				name:'shares',
				data:b2
			}
		]
	})
},200);
$('#buy').click(function(){
	 layer.open({
    title: [
      '买入',
      'background-color: #FF4351; color:#fff;'
    ]
    ,content:'<form class="layui-form" action="">'+
    ' <div class="layui-form-item">'+
    '<label class="layui-form-label">买入数量</label>'+
    '<div class="layui-input-block">'+
     ' <input type="text" name="number" required  lay-verify="required" placeholder="请输入数量" autocomplete="off" value="" class="layui-input">'+
    '</div>'+
  '</div>'+
  ' <div class="layui-form-item">'+
    '<label class="layui-form-label">买入价格</label>'+
    '<div class="layui-input-block">'+
     ' <input type="number" name="price" required  lay-verify="required" id="buy_price" placeholder="买入价格" readonly="readonly" autocomplete="off" value="0" class="layui-input">'+
    '</div>'+
  '</div>'+
'  <div class="layui-form-item">'+
   ' <div class="layui-input-block">'+
     ' <button class="layui-btn" lay-submit lay-filter="buy">购买</button>'+
      '<button type="reset" class="layui-btn layui-btn-primary" onclick="layer.closeAll()">关闭</button>'+
    '</div>'+
  '</div>'+
    '</form>'
  });
  $('.layui-layer .layui-layer-btn').remove();
});
$('#sail').click(function(){
	 layer.open({
    title: [
      '卖出',
      'background-color: #FF4351; color:#fff;'
    ]
    ,content:'<form class="layui-form" action="">'+
    ' <div class="layui-form-item">'+
    '<label class="layui-form-label">买出数量</label>'+
    '<div class="layui-input-block">'+
     ' <input type="text" name="number" required  lay-verify="required" placeholder="贩卖数量" autocomplete="off" value="" class="layui-input">'+
    '</div>'+
  '</div>'+
  ' <div class="layui-form-item">'+
    '<label class="layui-form-label">买出价格</label>'+
    '<div class="layui-input-block">'+
     ' <input type="number" name="price" required  lay-verify="required" id="sail_price" placeholder="卖出价格" readonly="readonly" autocomplete="off" value="0" class="layui-input">'+
    '</div>'+
  '</div>'+
'  <div class="layui-form-item">'+
   ' <div class="layui-input-block">'+
     ' <button class="layui-btn" lay-submit lay-filter="sail">卖出</button>'+
      '<button type="reset" class="layui-btn layui-btn-primary" onclick="layer.closeAll()">关闭</button>'+
    '</div>'+
  '</div>'+
    '</form>'
  });
  $('.layui-layer .layui-layer-btn').remove();
});

$('#prev,#next').click(function(){
	var _self=$(this);
	myChart.showLoading();
var a1=[],b1=[],a2=[],b2=[];
$.post(config.domain+'api/show_k/index.html',{date:_self.data('date'),code:localStorage.getItem('code'),'token':localStorage.getItem('token')},function(response){
		$('#name').text(response.data.name);
		$('#has').text(response.data.has);
		$('#prev').data('date',response.data.prev);
		$('#next').data('date',response.data.next);
		myChart.hideLoading();
		var c=new Date();
		var h=c.getHours();
		var m=c.getMinutes();
		if(h<10){
			h='0'+h;
		}
		if(m<10){
			m='0'+m;
		}
		var index=response.data.key.indexOf(h+':'+m)
		if(response.data.is_all){
			a1=[];
			b1=[];
			a2=response.data.key;
			b2=response.data.value;
		}else{
			a1=response.data.key.slice(index);
			a2=response.data.key.slice(0,index);
			b1=response.data.value.slice(index);
			b2=response.data.value.slice(0,index);
		}
		var tmp={
			title:{
				text:response.data.current,
			},
			xAxis:{
				data:a2
			},
			series:[
				{
					name:'shares',
					data:b2
				}
			]
		};
		myChart.setOption(tmp);
});

})
});
</script>
</body>
</html>